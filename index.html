<!doctype html>
<html>

<head>

    <meta charset="utf-8">
    <title>Leaflet Sync Demo - with three maps listening</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet-src.js"></script>
    <!-- styleSheets -->
    <link rel="stylesheet" href="interactiveMap.css" />
    <!-- scripts -->
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="OhioCounties.json"></script>
    <script src="L.Map.Sync.js"></script>
    <script src="interactiveMap.js"></script>


</head>

<body>
    <div id="map"></div>
    <div id="container">
        <div id="mapA" class="map"></div>
        <div id="mapB" class="map"></div>
    </div>
    <div id="map1title" class="title">
        <h2>Religion</h2>
        <p>pick class for each map</p>
    </div>
    <div id="map2title" class="title">
        <h2>Income (top) and Education (bottom)</h2>
    </div>
    <script>

        //global variables:
        var geojson;
        var map;
        // control that shows state info on hover
        var center = [40.25, -83];
        var REGmapOptions = {
            minZoom: 6,
            maxZoom: 7,
            id: 'mapbox.light'
        };

        var stamenOptions = {
            attribution:
                'Map tiles by <a href="http://stamen.com">Stamen Design</a>, ' +
                '<a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; ' +
                'Map data OpenStreetmap',
            subdomains: 'abcd',
            minZoom: 6,
            maxZoom: 7
        };
        var BWstreetmap = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
        var WaterColorMap = 'http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg';
        var map1base = L.tileLayer(BWstreetmap, REGmapOptions);
        var map2base = L.tileLayer(BWstreetmap, REGmapOptions);
        var map3base = L.tileLayer(BWstreetmap, REGmapOptions);
        var map1baseW = L.tileLayer(WaterColorMap, stamenOptions);
        var geojson1 = L.geoJson(counties, { style: style1, onEachFeature: onEachFeature });
        var geojson2 = L.geoJson(counties, { style: style2, onEachFeature: onEachFeature });
        var geojson3 = L.geoJson(counties, { style: style3, onEachFeature: onEachFeature });
        var map1layer = L.layerGroup([map1base, geojson1]);
        var map2layer = L.layerGroup([map2base, geojson2]);
        var map3layer = L.layerGroup([map3base, geojson3]);
        var map = L.map('map', {
            layers: [map1layer],
            center: center,
            zoom: 14,
            zoomControl: false
        });

        var mapA = L.map('mapA', {
            layers: [map2layer],
            center: center,
            zoom: 14,
            zoomControl: false
        });
        var mapB = L.map('mapB', {
            layers: [map3layer],
            center: center,
            zoom: 14,
            zoomControl: false
        });

        function style1(feature) {
            return {
                weight: .5,
                opacity: 1,
                color: 'black',
                dashArray: '3',
                fillOpacity: 1,
                fillColor: getColor(feature.properties.Catholic1980)
            };
        }
        function style2(feature) {
            return {
                weight: .5,
                opacity: 1,
                color: 'black',
                dashArray: '3',
                fillOpacity: 1,
                fillColor: getColor(feature.properties.I180)
            };
        }
        function style3(feature) {
            return {
                weight: .5,
                opacity: 1,
                color: 'black',
                dashArray: '3',
                fillOpacity: 1,
                fillColor: getColor(feature.properties.HS)
            };
        }

        var info = L.control({ position: 'topright' });
        geojson = L.geoJson(counties, { style: style1, onEachFeature: onEachFeature });
        var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
                grades = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90],
                labels = [],
                from, to;

            for (var i = 0; i < grades.length; i++) {
                from = grades[i];
                to = grades[i + 1];

                labels.push(
                    '<i style="background:' + getColor(from + 1) + '"></i> ' +
                    from + (to ? '%&ndash;' + to + '%' : '%+'));
            }

            div.innerHTML = labels.join('<br>');
            return div;
        };
        legend.addTo(map);

        //Adding legendA to MapB
        var info = L.control({ position: 'topright' });
        geojson = L.geoJson(counties, { style: style1, onEachFeature: onEachFeature });
        var legendA = L.control({ position: 'bottomright' });

        legendA.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
                grades = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90],
                labels = [],
                from, to;

            for (var i = 0; i < grades.length; i++) {
                from = grades[i];
                to = grades[i + 1];

                labels.push(
                    '<i style="background:' + getColor(from + 1) + '"></i> ' +
                    from + (to ? '%&ndash;' + to + '%' : '%+'));
            }

            div.innerHTML = labels.join('<br>');
            return div;
        };
        legendA.addTo(mapA);

        //Adding legendB to MapB
        var info = L.control({ position: 'topright' });
        geojson = L.geoJson(counties, { style: style1, onEachFeature: onEachFeature });
        var legendB = L.control({ position: 'bottomright' });

        legendB.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
                grades = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90],
                labels = [],
                from, to;

            for (var i = 0; i < grades.length; i++) {
                from = grades[i];
                to = grades[i + 1];

                labels.push(
                    '<i style="background:' + getColor(from + 1) + '"></i> ' +
                    from + (to ? '%&ndash;' + to + '%' : '%+'));
            }

            div.innerHTML = labels.join('<br>');
            return div;
        };
        legendB.addTo(mapB);

        // get color depending on population density value
        function getColor(d) {
            return d > 90 ? 'hsl(0, 100%, 50%)' :
                d > 80 ? 'hsl(40, 100%, 50%)' :
                    d > 70 ? 'hsl(80, 100%, 50%)' :
                        d > 60 ? 'hsl(120, 100%, 50%)' :
                            d > 50 ? 'hsl(160, 100%, 50%)' :
                                d > 40 ? 'hsl(200, 100%, 50%)' :
                                    d > 30 ? 'hsl(240, 100%, 50%)' :
                                        d > 20 ? 'hsl(280, 100%, 50%)' :
                                            d > 10 ? 'hsl(320, 100%, 50%)' :
                                                '#FFEDA0';
        }


        function highlightFeature(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });
        }


        function resetHighlight(e) {
            var layer = e.target;

            layer.setStyle({
                weight: .5,
                opacity: 1,
                color: 'black',
                dashArray: '3',
                fillOpacity: 1
            });
        }

        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }


        function onEachFeature(feature, layer) {
            var layerStyle = {};
            //Add popups with data and county name
            if (feature.properties.NAME) {
                layer.bindPopup("<b>County: </b>" + feature.properties.NAME)
            }
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight
            });
        }
        //!!!!!!!!!!!!!!!!!!!!
        map.sync(mapA, { syncCursor: true });
        map.sync(mapB, { syncCursor: true });

        // If you want interaction with mapA|B to be synchronized on map,
        // add other links as well.
        mapA.sync(map, { syncCursor: true });
        mapA.sync(mapB, { syncCursor: true });

        mapB.sync(map, { syncCursor: true });
        mapB.sync(mapA, { syncCursor: true });
    </script>
</body>

</html>
